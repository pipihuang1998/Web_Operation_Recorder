# 数据压缩策略指南 (Data Compression Guide)

本插件提供了灵活的数据压缩策略，以平衡捕获报文的完整性和数据量。您可以在 **Settings (设置)** 界面中配置这些策略。

## 为什么需要数据压缩？

在录制测试用例时，API 的请求体和响应体可能非常大。全量保存这些数据会导致：
1. **内存占用过高**：影响浏览器性能。
2. **报告体积过大**：不便于传输和存储。
3. **关键信息淹没**：难以快速定位核心数据结构。

然而，过度压缩（如仅保留结构）可能会丢失关键的业务数据（如 ID 列表），影响后续的关联分析。因此，我们提供了多种压缩模式以供选择。

## 压缩模式说明

### 1. 全量结构压缩 (Structure Mode) - **默认**

这是插件的默认行为，旨在最大程度地压缩数据。

*   **逻辑**：
    *   对于数组 (Array)：**仅保留第一个元素**。后续元素将被省略，并替换为一条提示信息（例如 `# ...省略后续N个相同结构的数据`）。
    *   对于对象 (Object)：递归处理每个字段。
*   **适用场景**：
    *   列表数据结构高度一致（如商品列表、用户列表）。
    *   关注点在于数据结构而非具体数据内容。
    *   对报告体积有严格限制。

### 2. 固定长度压缩 (Fixed Length Mode)

此模式根据数据的字符长度智能决定是否压缩。

*   **逻辑**：
    *   首先计算整个 JSON 对象的字符串长度。
    *   如果长度 **小于或等于** 设定的 **阈值 (Threshold)**，则**不进行压缩**，保留完整数据。
    *   如果长度 **超过** 阈值，则自动回退到 **全量结构压缩 (Structure Mode)**。
*   **配置参数**：
    *   **阈值 (Threshold)**：允许的最大字符数（默认为 1000）。
*   **适用场景**：
    *   希望保留短小的关键请求（如 ID 列表 `[101, 102, 103]`）。
    *   自动过滤掉体积巨大的冗余响应。

### 3. 固定元素压缩 (Fixed Element Count Mode)

此模式针对数组数据，保留指定数量的头部元素。

*   **逻辑**：
    *   对于数组 (Array)：保留前 **X** 个元素（X 由阈值决定）。
    *   超过 X 的部分将被截断，并添加提示信息。
    *   被保留的元素内部也会递归应用此压缩逻辑。
*   **配置参数**：
    *   **阈值 (Threshold)**：保留的数组元素个数 (Item Count)。
*   **适用场景**：
    *   需要分析列表中的前几个样本数据。
    *   ID 列表较长，保留前 10 个 ID 足够用于后续分析。

## 如何配置

1.  点击插件侧边栏顶部的 **设置 (Settings)** 按钮。
2.  找到 **数据压缩策略 (Data Compression)** 区域。
3.  **压缩模式 (Compression Mode)**：从下拉菜单中选择一种模式。
4.  **阈值 (Threshold)**：输入相应的数值。
    *   对于 "固定长度压缩"，单位是字符数。
    *   对于 "固定元素压缩"，单位是个数。
5.  点击底部的 **保存并返回** 按钮。

配置保存后，后续录制的所有网络请求将立即应用新的压缩策略。

## 示例对比

假设原始数据为：
```json
{
  "ids": [1, 2, 3, 4, 5],
  "users": [
    {"name": "A", "age": 10},
    {"name": "B", "age": 20},
    {"name": "C", "age": 30}
  ]
}
```

### 模式 1: 全量结构压缩
```json
{
  "ids": [1, "# ...省略后续4个相同结构的数据"],
  "users": [
    {"name": "A", "age": 10},
    "# ...省略后续2个相同结构的数据"
  ]
}
```

### 模式 2: 固定长度压缩 (阈值 1000)
*由于原始数据长度远小于 1000，保持原样：*
```json
{
  "ids": [1, 2, 3, 4, 5],
  "users": [
    {"name": "A", "age": 10},
    {"name": "B", "age": 20},
    {"name": "C", "age": 30}
  ]
}
```

### 模式 3: 固定元素压缩 (阈值 2)
```json
{
  "ids": [1, 2, "# ...省略后续3个数据"],
  "users": [
    {"name": "A", "age": 10},
    {"name": "B", "age": 20},
    "# ...省略后续1个数据"
  ]
}
```
